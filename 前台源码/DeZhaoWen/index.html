
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		<style>
			*{
				margin: 0px;
				padding: 0px;
			}
			
			#ctn{
				height: 655px;
				width: 100%;
			}
			.header{
				height:10%;
				background-color: #18416B;
			}
			.col-md-2{
				border-right:1px solid red;
				height: 100%;
			}

			.span1{
				display: inline-block;
				width: 20px;
				height: 20px;
				background-color: #D6D7CE;
				font-size: 14px;
				font-weight: bolder;
				border: 1px solid #fff;
			}
			.bod{
				height: 100%;
			}
			ul{
				margin-left: 20px;
			}
			iframe{
				border: 0px;
				width: 100%;
				height: 100%;
			}
			.leftguan{
				width: 14px;
				height: 60px;
				border-radius:0px 5px 5px 0px;
				position: absolute;
				top: 500px;
				left: 252px;
				background-color: #18416B;
				z-index: 1;
				color: #FFFFFF;
				padding-top: 20px;
			}
			.del{
				position: absolute;
				right: 0px;
				top: 0px;
			}
			.kx{
				font-size: 50px;
				color: #FFFFFF;
			}
			.tobu{
				color: #fff;
				display: inline-block;
				width: 150px;
				height: 100%;
				font-size: 17px;
			}
			.tobu:first-child{
				padding-left: 2000px;
				color: red;
			}
			.ddiv1{
				border: 2px solid #EFEBE7;
				width: 1000px;
				position: absolute;
				height: 600px;
				top: 80px;
				left: 300px;
				z-index: 2;
			}
			.ddiv3{
				position: absolute;
				top: 0px;
				right: 0px;
			}
			.item{
				margin-top: -32px;
			}
			#addmainmodal{
				position: absolute;
				top: 150px;
			}
			.tankuang{
				display: none !important;
			}
		</style>
		<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
	</head>
	<body>
		
		<div id="ctn" class="">
			<div class="header">
				<span class="kx">Âç°‰øÆÊô∫ÊÖßÁ≥ªÁªü</span>
				<span style="margin-left: 200px;"></span>
				<span class="tobu" v-for="item in tobu"  @click="find2(item.pvgid)">{{item.pvgName}}</span>
				<el-badge v-model="shuliang" class="item">
				  <el-button size="small" @click="zhanwjc">Á´ôÂ§ñÊé•ËΩ¶</el-button>
				</el-badge>
				<template>
				  <el-button class="tankuang"
					plain
					@click="open1">
					ËÆ¢Âçï
				  </el-button>
				 </template>
			</div>
			<div class="bod">
				<div v-if="this.leftx" class="col-md-2" style="background-color: #18304A; height: 950px;">
					<tree :list="list" @huan="huan"></tree>
				</div>
				<div id="tt" class="col-md-10" style="margin: 0px; padding: 0px;">
					<ul class="nav nav-tabs" style="background-color:#294173; margin-left: 0px; width: 100%; padding-left: 0px;">
						<li v-for="item,index in tabs" :class=" item.ac?'active':'' " >
							<a :href="'#'+item.id" data-toggle="tab">{{item.pvgName}}
								<span v-if="index!=0" @click="dd(index)" class="del">&times;</span>
							</a>
						</li>
					</ul>
					<div class="tab-content">
						<div v-for="item in tabs" :id="item.id" :class="['tab-pane',item.ac?'active':'']">
							<iframe :src="item.pvgPath" style="height: 615px;"></iframe>
						</div>
					</div>
				</div>
			</div>
			<div class="ddiv1" v-if="this.x">
				<div class="ddiv3">
					<span class="span1">üóï</span>
					<span class="span1" style="font-size: 14px;">üóñ</span>
					<span class="span1" style="font-size: 14px;" @click="out">&times;</span>
				</div>
				<iframe src="today.html"></iframe>
			</div>
			<div class="leftguan" @click="leftout">
				‚óÄ
			</div>
			
			
			<div class="modal fade" id="addmainmodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			  <div class="modal-dialog modal-lg" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					</h4>
			      </div>
			      <div class="modal-body">
			        	<div>
							
							
							<template>
								  <el-table
									:data="listp"
									style="width: 100%"
									max-height="250">
									<el-table-column
									  fixed
									  prop="id"
									  label="ÁºñÂè∑"
									  width="150">
									</el-table-column>
									<el-table-column
									  prop="name"
									  label="ÂßìÂêç"
									  width="120">
									</el-table-column>
									<el-table-column
									  prop="phone"
									  label="ÁîµËØù"
									  width="120">
									</el-table-column>
									<el-table-column
									  prop="chepai"
									  label="ËΩ¶Áâå"
									  width="120">
									</el-table-column>
									<el-table-column
									  prop="guzhang"
									  label="ÊïÖÈöú"
									  width="120">
									</el-table-column>
									<el-table-column
									  prop="adname"
									  label="Âú∞ÂùÄÂêçÁß∞"
									  width="120">
									</el-table-column>
									<el-table-column
									  prop="cost"
									  label="ÈáëÈ¢ù"
									  width="120">
									</el-table-column>
									<el-table-column
									  prop="distance"
									  label="Ë∑ùÁ¶ª"
									  width="120">
									</el-table-column>
									<el-table-column
									  prop="desc"
									  label="ËØ¶ÁªÜÂú∞ÂùÄ"
									  width="150">
									</el-table-column>
									<el-table-column
									  fixed="right"
									  label="Êìç‰Ωú"
									  width="120">
									  <template slot-scope="scope">
										<el-button
										  @click.native.prevent="deleteRow(scope.$index, tableData)"
										  type="text"
										  size="small">
										  ÁßªÈô§
										</el-button>
									  </template>
									</el-table-column>
								  </el-table>
								</template>						
						</div>
			      </div>
			     
			    </div>
			  </div>
			</div>
			
			
		</div>
		<script type="text/javascript" src="js/jquery-1.12.4.js" ></script>
		<script type="text/javascript" src="js/bootstrap.min.js" ></script>
		<script type="text/javascript" src="js/vue.js" ></script>
		
		<script src="js/constant.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/api/menu.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue-perms.js" type="text/javascript" charset="utf-8"></script>
				<!-- ÂºïÂÖ•Ê†∑Âºè -->
		<!-- ÂºïÂÖ•ÁªÑ‰ª∂Â∫ì -->
		<script src="https://unpkg.com/element-ui/lib/index.js"></script>
		<script type="text/javascript">
				var user = sessionStorage.getItem("user");
					if(!user){
						alert("ÊÇ®ËøòÊ≤°ÊúâÁôªÂΩïÔºåËØ∑ÈáçÊñ∞ÁôªÂΩïÂêéÂú®ËøõÂÖ•È¶ñÈ°µ.....");
						window.location.href="adminLogin.html";
					}
				Vue.directive("view",{
				bind(el,binding,vnode,oldVnode){
				},
				inserted(el,binding,vnode,oldVnode){
				},
				update(el,binding,vnode,oldVnode){
				}
			});
			
			Vue.component("tree",{
				props:["list"],
				template: `
					<ul class="nav nav-pills nav-stacked">
						<li v-for="item in list" >
							<a href="#" @click="huan(item)" style="color:violet">{{item.pvgName}}</a>
							<tree :list="item.children" @huan="huan"></tree>
						</li>
					</ul>
				`,
				methods:{
					huan(item){
						this.$emit("huan",item);
					}
				}
			});
			
			var vm=new Vue({
				el:"#ctn",
				data(){
					 return{
					 	l:[],
					 	list:[],
						tabs:[{pvgName:"È¶ñÈ°µ",ac:true,content:"‰∏Ä‰∏™‰∏∞ÂØåÁöÑÈ¶ñÈ°µ",id:"ho1",pvgPath:"jiesuanindex.html"}],
						tobu:[],
						x:true,
						leftx:true,
						user:{},
						user2:{},
						shuliang:null,
						listp:[],
					 }
				},
				methods:{
					findshow(){
						let that=this;
						$.ajax({
							url:"http://127.0.0.1:8080/waiqin/find",
							type:"post",
							success:function(result){
								that.listp=result;
							}
						});
					},
					open1() {
						this.$notify({
						  title: 'ÊèêÁ§∫',
						  message: '‰Ω†Êúâ‰∏ÄÊù°Êñ∞ÁöÑÊé•ËΩ¶ËÆ¢Âçï',
						  type: 'success'
						});
					 },
					deleteRow(index, rows) {
						rows.splice(index, 1);
						let that=this;
						$.ajax({
							url:"http://127.0.0.1:8080/waiqin/findwqi",
							type:"get",
							success:function(result){
								that.shuliang=result;
							}
						});
					 },
					zhanwjc(){
						$("#addmainmodal").modal("show");
					},
					chatiao(){
						if(this.shuliang==null){
							let that=this;
							$.ajax({
								url:"http://127.0.0.1:8080/waiqin/findwqi",
								type:"get",
								success:function(result){
									that.shuliang=result;
								}
							});
						}else{
							let that=this;
							$.ajax({
								url:"http://127.0.0.1:8080/waiqin/findwqi",
								type:"get",
								success:function(result){
									if(result!=that.shuliang){
										that.shuliang=result;
										that.open1();
										that.findshow();
									}
								}
							});
						}
					},
					
					
					
					huan(item){
//						this.leftx=false;
//						$(".leftguan").css("left","0px");
//						$(".leftguan").html("‚ñ∂");
//						$("#tt").css("width","100%");
						if(item.children && item.children.length>0){
							return;
						}
						this.tabs.forEach(item=>{
							item.ac=false;
						})
						this.$set(item,"ac",true);
						var flag=this.tabs.some(sitem=>sitem.pvgName==item.pvgName);
						if(!flag){
							this.tabs.push(item);
						}
						
					},
					dd(index){
						if(index==this.tabs.length-1)
						{
							this.tabs[index-1].ac=true;
							console.log(this.tabs[index-1]);
						}
						this.tabs.splice(index,1);
					},
					shuan(item){
						if(item.children && item.children.length>0){
							return;
						}
						this.tabs.forEach(item=>{
							item.ac=false;
						})
						this.$set(item,"ac",true);
					},
					out(){
						this.x=false;
					},
					diantop(item){
						console.log(item);
						if(item.pvgId==1){
							this.list=this.l;
						}else{
							this.list=[];
						}
					},
					run(){
						this.l=this.list;
					},
					leftout(){
						if(this.leftx){
							this.leftx=false;
							$(".leftguan").css("left","0px");
							$(".leftguan").html("‚ñ∂");
							$("#tt").css("width","100%");
						}else{
							this.leftx=true;
							$(".leftguan").css("left","252px");
							$(".leftguan").html("‚óÄ");
							$("#tt").css("width","");
						}
					},
					find(){
						this.user=JSON.parse(sessionStorage.getItem("user"));
						let that=this;
						$.ajax({
							url:"http://127.0.0.1:8080/dzwUser/getMenu",
							type:"post",
							data:{
								userId:that.user.userId,
								type:1
							},
							success:function(result){
								that.tobu=result;
							}
						});
					},
					find2(pide){
						this.user=JSON.parse(sessionStorage.getItem("user"));
						console.log(pide);
						let that=this;
						$.ajax({
							url:"http://127.0.0.1:8080/dzwUser/getMenu",
							type:"post",
							data:{
								userId:that.user.userId,
								type:2,
								pid:pide
							},
							success:function(result){
								console.log(result);
								that.list=result;
							}
						});
					},
					sumtime(){
						let that=this;
						var timer = setInterval(function(){
							that.chatiao()
						}, 1000);
					},
				},
				created(){
					this.findshow();
					this.sumtime();
					this.run();
					this.find();
					this.find2(1);
					this.chatiao();
					var user=JSON.parse(sessionStorage.getItem("user"));
					console.log(user.reserved1);
						menuApi.findPerms(parseInt(user.reserved1),function(result){
							data.perms = result;
						});
				},
				watch:{
					
				}
			});
			
		</script>
	</body>
</html>
